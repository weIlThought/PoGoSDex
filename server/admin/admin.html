<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin • PoGoSDex</title>
    <link rel="icon" href="/assets/favicon.ico" />
    <link rel="stylesheet" href="/admin.css" />
    <style>
      /* --- Custom admin polish --- */
      .modal {
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 10px 30px #0006;
        padding: 0;
        background: var(--card);
      }
      .modal-form {
        padding: 16px;
      }
      .modal-title {
        font-size: 1.125rem;
        margin-bottom: 8px;
      }
      .modal-actions {
        border-top: 1px solid var(--border);
        padding-top: 12px;
        margin-top: 8px;
      }
      input:focus,
      select:focus,
      textarea:focus {
        outline: 2px solid #3b82f666;
        border-color: #3b82f6;
      }
      th[data-sort] {
        cursor: pointer;
        position: relative;
        padding-right: 18px;
      }
      th[data-sort].sorted-asc::after {
        content: '▲';
        position: absolute;
        right: 12px;
        font-size: 0.75rem;
        color: #94a3b8;
      }
      th[data-sort].sorted-desc::after {
        content: '▼';
        position: absolute;
        right: 12px;
        font-size: 0.75rem;
        color: #94a3b8;
      }
      .sidebar-sep {
        height: 1px;
        background: var(--border);
        opacity: 0.8;
        margin: 8px 0 12px;
      }
      /* --- Dashboard polish --- */
      .cards-grid {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
      .metric-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
      }
      .metric-card h3 {
        color: var(--muted);
        font-size: 0.9rem;
        margin: 0 0 6px;
      }
      .metric-card .stat {
        font-size: 2rem;
        line-height: 1;
        letter-spacing: 0.01em;
      }
      .metric-card .stat.sm {
        font-size: 1.6rem;
      }
      .pill {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 999px;
        font-size: 0.85rem;
        border: 1px solid var(--border);
        background: #0b122a;
      }
      .spark {
        height: 48px;
      }
      .section-title {
        margin: 22px 4px 8px;
        font-size: 0.85rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }
      .mini-grid {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        align-items: start;
      }
      .mini-grid .mini {
        padding: 0;
      }
      .mini .mini-label {
        font-size: 0.8rem;
        color: var(--muted);
        margin-bottom: 4px;
      }
      .metric-card .divider {
        height: 1px;
        background: var(--border);
        margin: 10px 0;
        opacity: 0.7;
      }
      .metric-card {
        box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.03), 0 6px 16px rgba(0, 0, 0, 0.25);
      }
      @media (max-width: 720px) {
        .mini-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div class="brand" style="display: inline-flex; align-items: center; gap: 8px">
        <img src="/assets/logo.png" alt="PoGoSDex" style="height: 24px; width: auto" />
        <span>PoGoSDex Admin</span>
      </div>
      <nav class="actions">
        <button id="logoutBtn" class="btn">Logout</button>
      </nav>
    </header>
    <main class="layout">
      <aside class="sidebar" role="tablist" aria-orientation="vertical">
        <button class="tab active" role="tab" aria-selected="true" data-tab="dashboard">
          Dashboard
        </button>
        <div class="sidebar-sep" aria-hidden="true"></div>
        <button class="tab" role="tab" aria-selected="false" data-tab="issues">Issues</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="devices">Devices</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="news">News</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="coords">Coords</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="pulls">Pull Requests</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="archive">Archiv</button>
      </aside>
      <section class="content">
        <div id="toast" class="toast" hidden></div>

        <section id="panel-dashboard" class="panel" role="tabpanel">
          <div class="panel-header">
            <h2>Dashboard</h2>
            <div class="tools">
              <button id="dashRefresh" class="btn">Neu laden</button>
            </div>
          </div>
          <h3 class="section-title">Inhalte</h3>
          <div class="cards-grid">
            <div class="metric-card">
              <h3>Devices</h3>
              <div id="dashDevices" class="stat">–</div>
            </div>
            <div class="metric-card">
              <h3>News</h3>
              <div id="dashNews" class="stat">–</div>
            </div>
            <div class="metric-card">
              <h3>Coords</h3>
              <div id="dashCoords" class="stat">–</div>
            </div>
            <div class="metric-card">
              <h3>Issues</h3>
              <div id="dashIssues" class="stat">–</div>
            </div>
          </div>
          <h3 class="section-title">Besucher</h3>
          <div class="cards-grid">
            <div class="metric-card">
              <div class="mini-grid">
                <div class="mini">
                  <div class="mini-label">Heute</div>
                  <div id="dashVisitorsToday" class="stat sm">–</div>
                </div>
                <div class="mini">
                  <div class="mini-label">7 Tage</div>
                  <div id="dashVisitors7" class="stat sm">–</div>
                </div>
                <div class="mini">
                  <div class="mini-label">30 Tage</div>
                  <div id="dashVisitors30" class="stat sm">–</div>
                </div>
              </div>
            </div>
          </div>
          <h3 class="section-title">Unique Besucher</h3>
          <div class="cards-grid">
            <div class="metric-card">
              <div class="mini-grid">
                <div class="mini">
                  <div class="mini-label">Heute</div>
                  <div id="dashUniquesToday" class="stat sm">–</div>
                </div>
                <div class="mini">
                  <div class="mini-label">7 Tage</div>
                  <div id="dashUniques7" class="stat sm">–</div>
                </div>
                <div class="mini">
                  <div class="mini-label">30 Tage</div>
                  <div id="dashUniques30" class="stat sm">–</div>
                </div>
              </div>
            </div>
          </div>
          <h3 class="section-title">System</h3>
          <div class="cards-grid">
            <div class="metric-card">
              <h3>Uptime</h3>
              <div class="mt-2">
                <div>Status: <span id="dashUptimeStatus" class="pill">–</span></div>
                <div>Uptime (gesamt/30d): <span id="dashUptimeRatio">–</span></div>
              </div>
            </div>
            <div class="metric-card">
              <h3>Besucher gesamt</h3>
              <div class="mt-2">
                <div>Hits gesamt: <span id="dashVisitorsTotal">–</span></div>
                <div>Tage erfasst: <span id="dashVisitorsDays">–</span></div>
              </div>
            </div>
          </div>
          <h3 class="section-title">Trends</h3>
          <div class="cards-grid">
            <div class="metric-card">
              <h3>Trend (7 Tage) – Hits</h3>
              <div id="dashSparkHits" class="mt-2 spark"></div>
            </div>
            <div class="metric-card">
              <h3>Trend (7 Tage) – Unique</h3>
              <div id="dashSparkUniques" class="mt-2 spark"></div>
            </div>
          </div>
          <p class="mt-3 text-sm" style="color: #94a3b8">
            Hinweis: Die Unique-Zahlen sind datenschutzfreundlich und berücksichtigen Do-Not-Track
            sowie Opt-out. Werte können daher unter den Besucherzahlen liegen.
          </p>
        </section>

        <section id="panel-issues" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Issues</h2>
            <div class="tools">
              <select id="issuesStatus">
                <option value="">Alle</option>
                <option value="open">Open</option>
                <option value="in_progress">In Progress</option>
                <option value="closed">Closed</option>
              </select>
              <input id="issuesSearch" type="search" placeholder="Suche…" />
              <button id="issuesRefresh" class="btn">Neu laden</button>
              <button id="issuesNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="issuesTable">
            <thead>
              <tr>
                <th data-sort="id">ID</th>
                <th data-sort="title">Titel</th>
                <th data-sort="status">Status</th>
                <th>Tags</th>
                <th data-sort="updated_at">UpdatedAt</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <dialog id="issuesDialog" class="modal">
            <form id="issuesForm" method="dialog" class="form modal-form">
              <h3 id="issuesDialogTitle" class="modal-title">Issue</h3>
              <div
                id="issuesDialogId"
                class="text-sm"
                style="color: #94a3b8; margin-bottom: 6px"
              ></div>
              <input type="hidden" name="id" />
              <label><span>Titel</span><input name="title" required /></label>
              <label>
                <span>Status</span>
                <select name="status">
                  <option value="open">Open</option>
                  <option value="in_progress">In Progress</option>
                  <option value="closed">Closed</option>
                </select>
              </label>
              <label
                ><span>Tags (Komma-separiert)</span><input name="tags" placeholder="ui, bug"
              /></label>
              <label
                ><span>Inhalt</span><textarea name="content" rows="8" required></textarea>
              </label>
              <menu class="modal-actions">
                <button id="issuesCancel" type="button" class="btn">Abbrechen</button>
                <button id="issuesSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-devices" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Devices</h2>
            <div class="tools">
              <input id="devSearch" type="search" placeholder="Suche…" />
              <button id="devRefresh" class="btn">Neu laden</button>
              <button id="devNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="devTable">
            <thead>
              <tr>
                <th data-sort="id">ID</th>
                <th data-sort="model">Model</th>
                <th data-sort="brand">Brand</th>
                <th data-sort="type">Type</th>
                <th data-sort="os">OS</th>
                <th data-sort="compatible">Compatible</th>
                <th data-sort="price_range">PriceRange</th>
                <th data-sort="pogo_comp">PoGoComp</th>
                <th data-sort="manufacturer_url">Manufacturer</th>
                <th>Notes</th>
                <th>RootLinks</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <dialog id="devDialog" class="modal">
            <form id="devForm" method="dialog" class="form modal-form">
              <h3 id="devDialogTitle" class="modal-title">Device</h3>
              <div
                id="devDialogId"
                class="text-sm"
                style="color: #94a3b8; margin-bottom: 6px"
              ></div>
              <input type="hidden" name="id" />
              <label><span>Model</span><input name="model" required /></label>
              <label><span>Brand</span><input name="brand" /></label>
              <label><span>Type</span><input name="type" /></label>
              <label><span>OS</span><input name="os" placeholder="Android 13" /></label>
              <label>
                <span>Compatible</span>
                <select name="compatible">
                  <option value="1">Yes</option>
                  <option value="0">No</option>
                </select>
              </label>
              <label
                ><span>PriceRange</span><input name="price_range" placeholder="Flagship"
              /></label>
              <label><span>PoGoComp</span><input name="pogo_comp" placeholder="Excellent" /></label>
              <label
                ><span>Manufacturer URL</span
                ><input name="manufacturer_url" placeholder="https://…"
              /></label>
              <label
                ><span>Notes (eine pro Zeile)</span
                ><textarea name="notes" rows="4" placeholder="Note 1&#10;Note 2"></textarea>
              </label>
              <label
                ><span>RootLinks (eine pro Zeile)</span
                ><textarea
                  name="root_links"
                  rows="3"
                  placeholder="https://…&#10;https://…"
                ></textarea>
              </label>
              <menu class="modal-actions">
                <button id="devCancel" type="button" class="btn">Abbrechen</button>
                <button id="devSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-news" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>News</h2>
            <div class="tools">
              <input id="newsSearch" type="search" placeholder="Suche…" />
              <button id="newsRefresh" class="btn">Neu laden</button>
              <button id="newsNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="newsTable">
            <thead>
              <tr>
                <th data-sort="id">ID</th>
                <th data-sort="slug">Slug</th>
                <th data-sort="date">Datum</th>
                <th data-sort="title">Titel</th>
                <th data-sort="excerpt">Excerpt</th>
                <th data-sort="published_at">PublishedAt</th>
                <th data-sort="updated_at_ext">UpdatedAt</th>
                <th>Tags</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <dialog id="newsDialog" class="modal">
            <form id="newsForm" method="dialog" class="form modal-form">
              <h3 id="newsDialogTitle" class="modal-title">News</h3>
              <div
                id="newsDialogId"
                class="text-sm"
                style="color: #94a3b8; margin-bottom: 6px"
              ></div>
              <input type="hidden" name="id" />
              <label><span>Slug (ID)</span><input name="slug" placeholder="pgsharp-1-47" /></label>
              <label><span>Datum</span><input name="date" type="date" /></label>
              <label><span>Titel</span><input name="title" required /></label>
              <label><span>Excerpt</span><textarea name="excerpt" rows="3"></textarea></label>
              <label
                ><span>Inhalt</span><textarea name="content" rows="8" required></textarea>
              </label>
              <label
                ><span>Published At</span><input name="published_at" type="datetime-local"
              /></label>
              <label
                ><span>Updated At</span><input name="updated_at_ext" type="datetime-local"
              /></label>
              <label
                ><span>Tags (Komma-separiert)</span><input name="tags" placeholder="Update, Bugfix"
              /></label>
              <menu class="modal-actions">
                <button id="newsCancel" type="button" class="btn">Abbrechen</button>
                <button id="newsSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-coords" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Coords</h2>
            <div class="tools">
              <select id="coordsCategory">
                <option value="">Alle Kategorien</option>
                <option value="top10">Top 10</option>
                <option value="notable">Notable</option>
                <option value="raid_spots">Raid Spots</option>
              </select>
              <input id="coordsSearch" type="search" placeholder="Suche…" />
              <button id="coordsRefresh" class="btn">Neu laden</button>
              <button id="coordsNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="coordsTable">
            <thead>
              <tr>
                <th data-sort="id">ID</th>
                <th data-sort="category">Kategorie</th>
                <th data-sort="name">Name</th>
                <th data-sort="lat">Lat</th>
                <th data-sort="lng">Lng</th>
                <th>Tags</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <dialog id="coordsDialog" class="modal">
            <form id="coordsForm" method="dialog" class="form modal-form">
              <h3 id="coordsDialogTitle" class="modal-title">Coord</h3>
              <div
                id="coordsDialogId"
                class="text-sm"
                style="color: #94a3b8; margin-bottom: 6px"
              ></div>
              <input type="hidden" name="id" />
              <label>
                <span>Kategorie</span>
                <select name="category">
                  <option value="top10">Top 10</option>
                  <option value="notable">Notable</option>
                  <option value="raid_spots">Raid Spots</option>
                </select>
              </label>
              <label><span>Name</span><input name="name" required /></label>
              <label><span>Lat</span><input name="lat" type="number" step="any" required /></label>
              <label><span>Lng</span><input name="lng" type="number" step="any" required /></label>
              <label><span>Notiz</span><textarea name="note" rows="4"></textarea></label>
              <label
                ><span>Tags (Komma-separiert)</span><input name="tags" placeholder="park, top10"
              /></label>
              <menu class="modal-actions">
                <button id="coordsCancel" type="button" class="btn">Abbrechen</button>
                <button id="coordsSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-pulls" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Pull Requests</h2>
            <div class="tools">
              <input id="pullsSearch" type="search" placeholder="Suche…" />
              <button id="pullsRefresh" class="btn">Neu laden</button>
            </div>
          </div>
          <table class="table" id="pullsTable">
            <thead>
              <tr>
                <th data-sort="id">ID</th>
                <th data-sort="model">Model</th>
                <th data-sort="brand">Brand</th>
                <th data-sort="type">Type</th>
                <th data-sort="os">OS</th>
                <th data-sort="compatible">Compatible</th>
                <th>Notes</th>
                <th>RootLinks</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="panel-archive" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Archiv</h2>
            <div class="tools">
              <input id="archiveSearch" type="search" placeholder="Suche…" />
              <button id="archiveRefresh" class="btn">Neu laden</button>
            </div>
          </div>
          <table class="table" id="archiveTable">
            <thead>
              <tr>
                <th data-sort="id">ID</th>
                <th data-sort="model">Model</th>
                <th data-sort="brand">Brand</th>
                <th data-sort="type">Type</th>
                <th data-sort="os">OS</th>
                <th data-sort="rejected_at">RejectedAt</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </section>
    </main>
    <script defer src="/admin.js"></script>
  </body>
</html>

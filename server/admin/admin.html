<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin • PoGoSDex</title>
    <link rel="icon" href="/assets/favicon.ico" />
    <link rel="stylesheet" href="/admin.css" />
    <link rel="stylesheet" href="/admin-override.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand inline-flex items-center gap-2">
        <img src="/assets/logo.png" alt="PoGoSDex" class="h-6 w-auto" />
        <span>PoGoSDex Admin</span>
      </div>
      <nav class="actions">
        <button id="logoutBtn" class="btn">Logout</button>
      </nav>
    </header>
    <main class="layout">
      <aside class="sidebar" role="tablist" aria-orientation="vertical">
        <button class="tab active" role="tab" aria-selected="true" data-tab="dashboard">
          Dashboard
        </button>
        <div class="sidebar-sep" aria-hidden="true"></div>
        <button class="tab" role="tab" aria-selected="false" data-tab="issues">Issues</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="devices">Devices</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="news">News</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="coords">Coords</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="pulls">Pull Requests</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="archive">Archiv</button>
      </aside>
      <section class="content">
        <div id="toast" class="toast" hidden></div>

        <section id="panel-dashboard" class="panel" role="tabpanel">
          <div class="panel-header">
            <h2>Dashboard</h2>
            <div class="tools">
              <button id="dashRefresh" class="btn">Neu laden</button>
              <button id="dashResetAll" class="btn danger">Alles zurücksetzen</button>
            </div>
          </div>
          <div class="section">
            <h4 class="section-title">Kennzahlen</h4>
            <div class="cards-grid">
              <div class="metric-card">
                <h3>Devices</h3>
                <div id="dashDevices" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>News</h3>
                <div id="dashNews" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>Coords</h3>
                <div id="dashCoords" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>Issues</h3>
                <div id="dashIssues" class="stat">–</div>
              </div>
            </div>
          </div>

          <div class="section">
            <h4 class="section-title">Besucher</h4>
            <div class="cards-grid">
              <div class="metric-card">
                <h3>Heute</h3>
                <div id="dashVisitorsToday" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>7 Tage</h3>
                <div id="dashVisitors7" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>30 Tage</h3>
                <div id="dashVisitors30" class="stat">–</div>
              </div>
            </div>
          </div>

          <div class="section">
            <h4 class="section-title">Eindeutige Besucher</h4>
            <div class="cards-grid">
              <div class="metric-card">
                <h3>Heute</h3>
                <div id="dashUniquesToday" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>7 Tage</h3>
                <div id="dashUniques7" class="stat">–</div>
              </div>
              <div class="metric-card">
                <h3>30 Tage</h3>
                <div id="dashUniques30" class="stat">–</div>
              </div>
            </div>
          </div>

          <div class="section">
            <h4 class="section-title">System</h4>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="metric-card">
                <h3>Uptime</h3>
                <div class="mt-2">
                  <div>Status: <span id="dashUptimeStatus" class="pill">–</span></div>
                  <div>Uptime (gesamt/30d): <span id="dashUptimeRatio">–</span></div>
                </div>
              </div>
              <div class="metric-card">
                <h3>Besucher gesamt</h3>
                <div class="mt-2">
                  <div>Hits gesamt: <span id="dashVisitorsTotal">–</span></div>
                  <div>Tage erfasst: <span id="dashVisitorsDays">–</span></div>
                </div>
              </div>
            </div>
          </div>

          <div class="section">
            <h4 class="section-title">Trends</h4>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="metric-card">
                <h3>Trend (7 Tage) – Hits</h3>
                <div id="dashSparkHits" class="mt-2 spark"></div>
              </div>
              <div class="metric-card">
                <h3>Trend (7 Tage) – Unique</h3>
                <div id="dashSparkUniques" class="mt-2 spark"></div>
              </div>
            </div>
          </div>

          <p class="note">
            Hinweis: Unique-Zahlen basieren auf täglich neu erzeugten, gehashten Sitzungskennungen
            (IP + User-Agent + Tag, mit Salt). "Do Not Track" und Opt-out werden respektiert.
          </p>
        </section>

        <section id="panel-issues" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Issues</h2>
            <div class="tools">
              <select id="issuesStatus">
                <option value="">Alle</option>
                <option value="open">Open</option>
                <option value="in_progress">In Progress</option>
                <option value="closed">Closed</option>
              </select>
              <input id="issuesSearch" type="search" placeholder="Suche…" />
              <button id="issuesReset" class="btn">Zurücksetzen</button>
              <button id="issuesRefresh" class="btn">Neu laden</button>
              <button id="issuesExport" class="btn">Export CSV</button>
              <button id="issuesNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="issuesTable">
            <thead>
              <tr>
                <th class="sticky top-0" data-sort="id">ID</th>
                <th class="sticky top-0" data-sort="title">Titel</th>
                <th class="sticky top-0" data-sort="status">Status</th>
                <th class="sticky top-0">Tags</th>
                <th class="sticky top-0" data-sort="updated_at">UpdatedAt</th>
                <th class="sticky top-0">Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="flex items-center justify-between mt-3">
            <div class="text-sm text-slate-400" id="issuesPageInfo"></div>
            <div class="flex items-center gap-2">
              <label class="text-sm text-slate-400" for="issuesPageSize">Pro Seite:</label>
              <select id="issuesPageSize">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <button id="issuesPrev" class="btn" disabled>Zurück</button>
              <button id="issuesNext" class="btn">Weiter</button>
            </div>
          </div>
          <dialog id="issuesDialog" class="modal">
            <form id="issuesForm" method="dialog" class="form modal-form">
              <h3 id="issuesDialogTitle" class="modal-title">Issue</h3>
              <div id="issuesDialogId" class="text-sm text-slate-400 mb-1.5"></div>
              <input type="hidden" name="id" />
              <label><span>Titel</span><input name="title" required /></label>
              <label>
                <span>Status</span>
                <select name="status">
                  <option value="open">Open</option>
                  <option value="in_progress">In Progress</option>
                  <option value="resolved">Resolved</option>
                  <option value="blocked">Blocked</option>
                  <option value="closed">Closed</option>
                </select>
              </label>
              <label
                ><span>Tags (Komma-separiert)</span><input name="tags" placeholder="ui, bug"
              /></label>
              <label
                ><span>Inhalt</span><textarea name="content" rows="8" required></textarea>
              </label>
              <menu class="modal-actions">
                <button id="issuesCancel" type="button" class="btn">Abbrechen</button>
                <button id="issuesSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-devices" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Devices</h2>
            <div class="tools">
              <input id="devSearch" type="search" placeholder="Suche…" />
              <button id="devReset" class="btn">Zurücksetzen</button>
              <button id="devRefresh" class="btn">Neu laden</button>
              <button id="devExport" class="btn">Export CSV</button>
              <button id="devNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="devTable">
            <thead>
              <tr>
                <th class="sticky top-0" data-sort="id">ID</th>
                <th class="sticky top-0" data-sort="model">Model</th>
                <th class="sticky top-0" data-sort="brand">Brand</th>
                <th class="sticky top-0" data-sort="type">Type</th>
                <th class="sticky top-0" data-sort="os">OS</th>
                <th class="sticky top-0" data-sort="compatible">Compatible</th>
                <th class="sticky top-0" data-sort="price_range">PriceRange</th>
                <th class="sticky top-0" data-sort="pogo_comp">PoGoComp</th>
                <th class="sticky top-0" data-sort="manufacturer_url">Manufacturer</th>
                <th class="sticky top-0">Notes</th>
                <th class="sticky top-0">RootLinks</th>
                <th class="sticky top-0">Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="flex items-center justify-between mt-3">
            <div class="text-sm text-slate-400" id="devPageInfo"></div>
            <div class="flex items-center gap-2">
              <label class="text-sm text-slate-400" for="devPageSize">Pro Seite:</label>
              <select id="devPageSize">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <button id="devPrev" class="btn" disabled>Zurück</button>
              <button id="devNext" class="btn">Weiter</button>
            </div>
          </div>
          <dialog id="devDialog" class="modal">
            <form id="devForm" method="dialog" class="form modal-form">
              <h3 id="devDialogTitle" class="modal-title">Device</h3>
              <div id="devDialogId" class="text-sm text-slate-400 mb-1.5"></div>
              <input type="hidden" name="id" />
              <label><span>Model</span><input name="model" required /></label>
              <label><span>Brand</span><input name="brand" /></label>
              <label><span>Type</span><input name="type" /></label>
              <label><span>OS</span><input name="os" placeholder="Android 13" /></label>
              <label>
                <span>Compatible</span>
                <select name="compatible">
                  <option value="1">Yes</option>
                  <option value="0">No</option>
                </select>
              </label>
              <label
                ><span>PriceRange</span><input name="price_range" placeholder="Flagship"
              /></label>
              <label><span>PoGoComp</span><input name="pogo_comp" placeholder="Excellent" /></label>
              <label
                ><span>Manufacturer URL</span
                ><input name="manufacturer_url" placeholder="https://…"
              /></label>
              <label
                ><span>Notes (eine pro Zeile)</span
                ><textarea name="notes" rows="4" placeholder="Note 1&#10;Note 2"></textarea>
              </label>
              <label
                ><span>RootLinks (eine pro Zeile)</span
                ><textarea
                  name="root_links"
                  rows="3"
                  placeholder="https://…&#10;https://…"
                ></textarea>
              </label>
              <menu class="modal-actions">
                <button id="devCancel" type="button" class="btn">Abbrechen</button>
                <button id="devSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-news" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>News</h2>
            <div class="tools">
              <input id="newsSearch" type="search" placeholder="Suche…" />
              <button id="newsReset" class="btn">Zurücksetzen</button>
              <button id="newsRefresh" class="btn">Neu laden</button>
              <button id="newsExport" class="btn">Export CSV</button>
              <button id="newsNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="newsTable">
            <thead>
              <tr>
                <th class="sticky top-0" data-sort="id">ID</th>
                <th class="sticky top-0" data-sort="slug">Slug</th>
                <th class="sticky top-0" data-sort="date">Datum</th>
                <th class="sticky top-0" data-sort="title">Titel</th>
                <th class="sticky top-0" data-sort="excerpt">Excerpt</th>
                <th class="sticky top-0" data-sort="published_at">PublishedAt</th>
                <th class="sticky top-0" data-sort="updated_at_ext">UpdatedAt</th>
                <th class="sticky top-0">Tags</th>
                <th class="sticky top-0">Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="flex items-center justify-between mt-3">
            <div class="text-sm text-slate-400" id="newsPageInfo"></div>
            <div class="flex items-center gap-2">
              <label class="text-sm text-slate-400" for="newsPageSize">Pro Seite:</label>
              <select id="newsPageSize">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <button id="newsPrev" class="btn" disabled>Zurück</button>
              <button id="newsNext" class="btn">Weiter</button>
            </div>
          </div>
          <dialog id="newsDialog" class="modal">
            <form id="newsForm" method="dialog" class="form modal-form">
              <h3 id="newsDialogTitle" class="modal-title">News</h3>
              <div id="newsDialogId" class="text-sm text-slate-400 mb-1.5"></div>
              <input type="hidden" name="id" />
              <label><span>Slug (ID)</span><input name="slug" placeholder="pgsharp-1-47" /></label>
              <label><span>Datum</span><input name="date" type="date" /></label>
              <label><span>Titel</span><input name="title" required /></label>
              <label><span>Excerpt</span><textarea name="excerpt" rows="3"></textarea></label>
              <label
                ><span>Inhalt</span><textarea name="content" rows="8" required></textarea>
              </label>
              <label
                ><span>Published At</span><input name="published_at" type="datetime-local"
              /></label>
              <label
                ><span>Updated At</span><input name="updated_at_ext" type="datetime-local"
              /></label>
              <label
                ><span>Tags (Komma-separiert)</span><input name="tags" placeholder="Update, Bugfix"
              /></label>
              <menu class="modal-actions">
                <button id="newsCancel" type="button" class="btn">Abbrechen</button>
                <button id="newsSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-coords" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Coords</h2>
            <div class="tools">
              <select id="coordsCategory">
                <option value="">Alle Kategorien</option>
                <option value="top10">Top 10</option>
                <option value="notable">Notable</option>
                <option value="raid_spots">Raid Spots</option>
              </select>
              <input id="coordsSearch" type="search" placeholder="Suche…" />
              <button id="coordsReset" class="btn">Zurücksetzen</button>
              <button id="coordsRefresh" class="btn">Neu laden</button>
              <button id="coordsExport" class="btn">Export CSV</button>
              <button id="coordsNew" class="btn primary">Neu</button>
            </div>
          </div>
          <table class="table" id="coordsTable">
            <thead>
              <tr>
                <th class="sticky top-0" data-sort="id">ID</th>
                <th class="sticky top-0" data-sort="category">Kategorie</th>
                <th class="sticky top-0" data-sort="name">Name</th>
                <th class="sticky top-0" data-sort="lat">Lat</th>
                <th class="sticky top-0" data-sort="lng">Lng</th>
                <th class="sticky top-0">Tags</th>
                <th class="sticky top-0">Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="flex items-center justify-between mt-3">
            <div class="text-sm text-slate-400" id="coordsPageInfo"></div>
            <div class="flex items-center gap-2">
              <label class="text-sm text-slate-400" for="coordsPageSize">Pro Seite:</label>
              <select id="coordsPageSize">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <button id="coordsPrev" class="btn" disabled>Zurück</button>
              <button id="coordsNext" class="btn">Weiter</button>
            </div>
          </div>
          <dialog id="coordsDialog" class="modal">
            <form id="coordsForm" method="dialog" class="form modal-form">
              <h3 id="coordsDialogTitle" class="modal-title">Coord</h3>
              <div id="coordsDialogId" class="text-sm text-slate-400 mb-1.5"></div>
              <input type="hidden" name="id" />
              <label>
                <span>Kategorie</span>
                <select name="category">
                  <option value="top10">Top 10</option>
                  <option value="notable">Notable</option>
                  <option value="raid_spots">Raid Spots</option>
                </select>
              </label>
              <label><span>Name</span><input name="name" required /></label>
              <label><span>Lat</span><input name="lat" type="number" step="any" required /></label>
              <label><span>Lng</span><input name="lng" type="number" step="any" required /></label>
              <label><span>Notiz</span><textarea name="note" rows="4"></textarea></label>
              <label
                ><span>Tags (Komma-separiert)</span><input name="tags" placeholder="park, top10"
              /></label>
              <menu class="modal-actions">
                <button id="coordsCancel" type="button" class="btn">Abbrechen</button>
                <button id="coordsSave" value="confirm" class="btn primary">Speichern</button>
              </menu>
            </form>
          </dialog>
        </section>

        <section id="panel-pulls" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Pull Requests</h2>
            <div class="tools">
              <input id="pullsSearch" type="search" placeholder="Suche…" />
              <button id="pullsReset" class="btn">Zurücksetzen</button>
              <button id="pullsRefresh" class="btn">Neu laden</button>
              <button id="pullsExport" class="btn">Export CSV</button>
            </div>
          </div>
          <table class="table" id="pullsTable">
            <thead>
              <tr>
                <th class="sticky top-0" data-sort="id">ID</th>
                <th class="sticky top-0" data-sort="model">Model</th>
                <th class="sticky top-0" data-sort="brand">Brand</th>
                <th class="sticky top-0" data-sort="type">Type</th>
                <th class="sticky top-0" data-sort="os">OS</th>
                <th class="sticky top-0" data-sort="compatible">Compatible</th>
                <th class="sticky top-0">Notes</th>
                <th class="sticky top-0">RootLinks</th>
                <th class="sticky top-0">Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="flex items-center justify-between mt-3">
            <div class="text-sm text-slate-400" id="pullsPageInfo"></div>
            <div class="flex items-center gap-2">
              <label class="text-sm text-slate-400" for="pullsPageSize">Pro Seite:</label>
              <select id="pullsPageSize">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <button id="pullsPrev" class="btn" disabled>Zurück</button>
              <button id="pullsNext" class="btn">Weiter</button>
            </div>
          </div>
        </section>

        <section id="panel-archive" class="panel hidden" role="tabpanel">
          <div class="panel-header">
            <h2>Archiv</h2>
            <div class="tools">
              <input id="archiveSearch" type="search" placeholder="Suche…" />
              <button id="archiveReset" class="btn">Zurücksetzen</button>
              <button id="archiveRefresh" class="btn">Neu laden</button>
              <button id="archiveExport" class="btn">Export CSV</button>
            </div>
          </div>
          <table class="table" id="archiveTable">
            <thead>
              <tr>
                <th class="sticky top-0" data-sort="id">ID</th>
                <th class="sticky top-0" data-sort="model">Model</th>
                <th class="sticky top-0" data-sort="brand">Brand</th>
                <th class="sticky top-0" data-sort="type">Type</th>
                <th class="sticky top-0" data-sort="os">OS</th>
                <th class="sticky top-0" data-sort="rejected_at">RejectedAt</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="flex items-center justify-between mt-3">
            <div class="text-sm text-slate-400" id="archivePageInfo"></div>
            <div class="flex items-center gap-2">
              <label class="text-sm text-slate-400" for="archivePageSize">Pro Seite:</label>
              <select id="archivePageSize">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <button id="archivePrev" class="btn" disabled>Zurück</button>
              <button id="archiveNext" class="btn">Weiter</button>
            </div>
          </div>
        </section>
      </section>
    </main>
    <script defer src="/admin.js"></script>
  </body>
</html>
